# ｃ

## 1. アプリケーション概要

### 1.1 アプリ名
テキスト消しゴムアプリ

### 1.2 目的
画像上のテキストを消去し、新しいテキストを追加できるWebベースの画像編集アプリケーション

### 1.3 主要機能
- 画像上のテキストを消しゴムツールで消去
- 新しいテキストの追加と編集
- 編集した画像の保存・ダウンロード

## 2. 技術仕様

### 2.1 使用技術
- HTML5
- CSS3
- JavaScript (Vanilla JS)
- Canvas API
- Web Storage API (localStorage)

### 2.2 対応ブラウザ
- モダンブラウザ全般（Chrome、Firefox、Safari、Edge）
- タッチデバイス対応（ピンチジェスチャー）

### 2.3 フォントサポート
- Noto Sans JP（カスタムフォント）
- 游ゴシック、游明朝
- メイリオ、MSゴシック、MS明朝
- Arial、Times New Roman、Courier New

## 3. 機能詳細

### 3.1 画像読み込み機能
- **ファイル形式**: 画像ファイル全般（JPG、PNG、GIF等）
- **ファイルサイズ制限**: 5MB以下
- **プライバシー保護**: ブラウザ内でのみ処理、サーバー送信なし
- **状態リセット**: 新しい画像読み込み時に全状態をリセット

### 3.2 消しゴム機能
- **サイズ調整**: 10px〜100px（スライダーで調整）
- **消去モード**:
  - 通常消去: 完全に消去
  - スマート消去: 背景色を保持しながらテキストのみ消去
- **リアルタイム表示**: カーソル位置に消しゴムサイズを表示
- **操作方法**: ドラッグで連続消去

### 3.3 テキスト追加・編集機能
- **追加方法**: キャンバスクリックで位置指定
- **テキスト属性**:
  - サイズ: 12px〜100px
  - フォントファミリー: 9種類から選択
  - 太さ: 標準/太字
  - 色: 10色プリセット（黒、赤、青、緑、オレンジ、紫、ピンク、茶色、グレー、白）
  - 書字方向: 横書き/縦書き
- **編集機能**:
  - ドラッグで移動
  - リサイズハンドルでサイズ変更
  - ダブルクリックで編集パネル表示
  - ピンチジェスチャーでサイズ変更（タッチデバイス）

### 3.4 履歴管理機能
- **アンドゥ機能**: 最大20ステップの履歴保存
- **キーボードショートカット**: Ctrl+Z / Cmd+Z
- **履歴内容**: キャンバス状態とテキストオブジェクト

### 3.5 保存機能
- **一時保存**:
  - localStorage使用
  - 保存後自動で読み込み実行
  - ブラウザを閉じても保持
- **画像ダウンロード**:
  - PNG形式
  - 白背景を自動追加
  - タイムスタンプ付きファイル名

## 4. UI/UX仕様

### 4.1 レイアウト
- **最大幅**: 800px（中央寄せ）
- **レスポンシブ対応**: キャンバスサイズに応じて自動調整

### 4.2 デザイン要素
- **メインカラー**: #4CAF50（緑系）
- **アクセントカラー**: 
  - #2196F3（青）: ダウンロードボタン
  - #FF9800（オレンジ）: アンドゥボタン
  - #9C27B0（紫）: 読み込みボタン
- **グラデーション効果**: タイトルと使い方説明ボックス
- **アニメーション**: 使い方CTAのパルス効果

### 4.3 操作フロー
1. 画像を選択して読み込み
2. 消しゴムツールでテキスト消去
3. テキストツールで新規テキスト追加
4. 一時保存実行
5. 読み込みボタンで最終確認
6. 保存ボタンでダウンロード

### 4.4 使い方説明
- ステップバイステップの手順表示
- 番号付きリスト（視覚的な円形番号）
- アイコン付きタイトル（📋）

## 5. 内部実装詳細

### 5.1 キャンバス管理
- **メインキャンバス**: 表示用（テキストオブジェクト含む）
- **ベースキャンバス**: 消しゴム編集状態の保持用

### 5.2 座標計算
- キャンバスのスケーリングを考慮した座標変換
- getBoundingClientRect()を使用した正確な位置計算

### 5.3 テキストオブジェクト管理
```javascript
textObject = {
    id: タイムスタンプ,
    text: テキスト内容,
    x: X座標,
    y: Y座標,
    fontSize: フォントサイズ,
    fontWeight: フォントの太さ,
    fontFamily: フォントファミリー,
    color: テキスト色,
    textAlign: テキスト配置,
    writingMode: 書字方向 // 'horizontal' または 'vertical'
}
```

### 5.4 スマート消去アルゴリズム
1. 消去エリア周辺の背景色をサンプリング（8点）
2. 各ピクセルの色と背景色の差分計算
3. 差分が閾値（50）を超える場合、背景色で置換
4. テキストやイラスト部分のみを選択的に消去

### 5.5 縦書きテキスト描画アルゴリズム
1. writingModeが'vertical'の場合、テキストを1文字ずつ分割
2. 各文字を縦方向に配置（Y座標を文字インデックス × 行間で計算）
3. 複数行の場合、各行を左方向にずらして配置（X座標を行インデックス × 行間で計算）
4. 境界ボックス計算も縦書き用に調整（幅と高さを入れ替え）

## 6. セキュリティ・プライバシー

### 6.1 データ処理
- 全処理をクライアントサイドで実行
- サーバーへの画像送信なし
- 外部APIの不使用

### 6.2 ローカルストレージ
- 一時保存データのみ保存
- 個人情報の保存なし

## 7. 制限事項

### 7.1 ファイルサイズ
- アップロード上限: 5MB

### 7.2 ブラウザ依存
- Canvas APIサポートブラウザが必要
- IE非対応

### 7.3 パフォーマンス
- 大きな画像での処理速度低下の可能性
- 履歴保存数の上限（20ステップ）

## 8. 今後の拡張可能性

- レイヤー機能の追加
- より高度な画像フィルター
- クラウド保存機能
- 複数形式での画像エクスポート
- AIを使用したスマート消去の改善